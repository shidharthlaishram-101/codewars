<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= title %></title>
  <link rel="stylesheet" href="/css/admin.css">
</head>
<body>

  <header>
    <nav class="container">
      <a href="/admin" class="logo">CodeWars Admin</a>
    </nav>
  </header>

  <main class="container">
    <h1>Registered Teams</h1>
    <p class="subtitle">Live data of Registered Participants</p>

    <div class="search-bar">
      <input type="text" id="searchInput" placeholder="Search by name, branch, or code...">
    </div>

    <% if (participants.length > 0) { %>
      <table class="participant-table">
        <thead>
          <tr>
            <th>#</th>
            <th>Team Code</th>
            <th>Type</th>
            <th>Participants</th>
            <th>Registered At</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody id="participantTable">
          <% participants.forEach((team, index) => { %>
            <tr>
              <td><%= index + 1 %></td>
              <td><strong><%= team.code || "N/A" %></strong></td>
              <td>
                <% if (team.type) { %>
                  <span class="type-badge <%= team.type === 'duet' ? 'duet' : 'solo' %>">
                    <%= team.type.charAt(0).toUpperCase() + team.type.slice(1) %>
                  </span>
                <% } else { %>
                  <em>Unknown</em>
                <% } %>
              </td>
              <td>
                <% if (Array.isArray(team.participants)) { %>
                  <% team.participants.forEach((p, i) => { %>
                    <div class="participant-block">
                      <strong>Participant <%= i + 1 %></strong><br>
                      Name: <%= p.name || "N/A" %><br>
                      Email: <%= p.email || "N/A" %><br>
                      Phone: <%= p.phone || "N/A" %><br>
                      Branch: <%= p.branch || "N/A" %><br>
                      Semester: <%= p.semester || "N/A" %>
                    </div>
                    <% if (i === 0 && team.participants.length > 1) { %><hr><% } %>
                  <% }) %>
                <% } else { %>
                  <em>No participant data</em>
                <% } %>
              </td>
              <td><%= team.createdAt ? new Date(team.createdAt._seconds * 1000).toLocaleString() : "N/A" %></td>
              <td>
                <form action="/admin/delete" method="POST" onsubmit="return confirmDelete()">
                  <input type="hidden" name="id" value="<%= team.id %>">
                  <button class="btn btn-danger">Delete</button>
                </form>
              </td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    <% } else { %>
      <p class="no-data">No registered teams found.</p>
    <% } %>
  </main>

  <footer>
    <p>&copy; 2025 CodeWars Admin. All rights reserved.</p>
  </footer>

  <script>
    function confirmDelete() {
      return confirm('Are you sure you want to delete this registration?');
    }
  </script>

  <script src="/js/admin.js"></script>
</body>
</html>

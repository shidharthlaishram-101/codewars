<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contest Page - CodeComp</title>
    <link rel="stylesheet" href="/css/contest.css">
</head>
<body>

    <header>
        <nav class="container">
            <!-- <a href="/" class="logo">CodeWars</a> -->
            <div class="contest-timer">Time Left: <strong>03:00:00</strong></div>
            <ul>
                <li>
                    <button id="theme-toggle" class="theme-toggle-btn" onclick="toggleTheme()" aria-label="Toggle dark mode">
                        <span class="theme-icon">ðŸŒ™</span>
                    </button>
                </li>
                <li><button id="end-session-btn" class="btn btn-secondary">End Session</button></li>
            </ul>
        </nav>
    </header>

    <div class="contest-container">
        
        <aside class="problem-sidebar">
            <div class="problem-list">
                <h3>Easy Level Problems</h3>
                <ul>
                    <li class="active"><a href="#">A. Two Sum</a></li>
                    <li><a href="#">B. Valid Parentheses</a></li>
                    <!-- <li><a href="#">C. Merge K Sorted Lists</a></li>
                    <li><a href="#">D. The Trapped Rain Water</a></li> -->
                </ul>
            </div>

            <div class="problem-statement">
                <h2>A. Two Sum</h2>
                <span class="tag">Easy</span>
                <p>Given an array of integers <code>nums</code> and an integer <code>target</code>, return indices of the two numbers such that they add up to <code>target</code>.</p>
                <p>You may assume that each input would have <strong>exactly one solution</strong>, and you may not use the same element twice. You can return the answer in any order.</p>

                <h3>Example 1:</h3>
                <pre>
<strong>Input:</strong> nums = [2,7,11,15], target = 9
<strong>Output:</strong> [0,1]
<strong>Explanation:</strong> Because nums[0] + nums[1] == 9, we return [0, 1].
                </pre>

                <h3>Example 2:</h3>
                <pre>
<strong>Input:</strong> nums = [3,2,4], target = 6
<strong>Output:</strong> [1,2]
                </pre>

                <h3>Constraints:</h3>
                <ul>
                    <li><code>2 <= nums.length <= 10^4</code></li>
                    <li><code>-10^9 <= nums[i] <= 10^9</code></li>
                    <li><code>-10^9 <= target <= 10^9</code></li>
                    <li>Only one valid answer exists.</li>
                </ul>
            </div>
        </aside>

        <main class="code-sidebar">
            <div class="code-editor-container">
                <div class="editor-header">
                    <label for="language">Language:</label>
                    <select id="language" name="language">
                        <option value="python">Python</option>
                        <option value="java">Java</option>
                        <option value="c">C</option>
                    </select>
                    <div class="navigation-buttons" style="display:inline-block;margin-left:1rem;">
                        <button id="prev-question-btn" class="btn btn-secondary" style="margin-right:0.5rem;" disabled>Previous Question</button>
                        <button id="next-question-btn" class="btn btn-secondary">Next Question</button>
                    </div>
                </div>             
                <textarea id="code-editor" spellcheck="false">
# Write your code here
def solve():
    pass
                </textarea>
                
                <div class="editor-footer">
                    <button id="run-code-btn" class="btn btn-secondary">Run Code</button>
                    <button id="submit-code-btn" class="btn btn-primary">Submit Solution</button>
                </div>
            </div>

            <div class="submission-status">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <h3>Output</h3>
                    <button id="clear-output-btn" class="btn btn-secondary" style="padding: 0.5rem 1rem; font-size: 0.9rem;">Clear</button>
                </div>
                <div id="output-content">
                    <p class="output-placeholder">Output will appear here...</p>
                </div>
            </div>
        </main>
    </div>

    <!-- Contest Ended Modal -->
    <div id="contest-ended-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <h2>Contest Has Ended</h2>
            <p>Thank you for participating in the contest!</p>
            <p>We would love to hear your feedback about your experience.</p>
            <button class="btn btn-primary" onclick="window.location.href='/feedback'">
                Share Your Feedback
            </button>
        </div>
    </div>

    <script src="/js/darkmode.js"></script>
    <script src="/js/timer_contest.js"></script>
    <script src="/js/contest.js"></script>
    <script>
        // End Session button handler
        document.addEventListener('DOMContentLoaded', function() {
            const endSessionBtn = document.getElementById('end-session-btn');
            if (endSessionBtn) {
                endSessionBtn.addEventListener('click', async function() {
                    // Confirm action
                    if (confirm('Are you sure you want to end your contest session? You will be redirected to the feedback page.')) {
                        try {
                            // Call endpoint to mark contest as ended
                            const response = await fetch('/end-contest-session', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json'
                                }
                            });

                            const data = await response.json();
                            
                            if (response.ok) {
                                // Show the contest ended modal
                                if (typeof showContestEndedModal === 'function') {
                                    showContestEndedModal();
                                } else {
                                    // Fallback if function not available yet
                                    const modal = document.getElementById('contest-ended-modal');
                                    if (modal) {
                                        modal.style.display = 'flex';
                                        document.body.style.overflow = 'hidden';
                                    }
                                }
                            } else {
                                alert('Error ending session. Please try again.');
                            }
                        } catch (error) {
                            console.error('Error ending session:', error);
                            // Still show modal even if request fails
                            if (typeof showContestEndedModal === 'function') {
                                showContestEndedModal();
                            } else {
                                const modal = document.getElementById('contest-ended-modal');
                                if (modal) {
                                    modal.style.display = 'flex';
                                    document.body.style.overflow = 'hidden';
                                }
                            }
                        }
                    }
                });
            }
        });
    </script>
</body>
</html>
